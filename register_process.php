<?php require 'db.php'; function generateCode($length = 6) { return str_pad(random_int(0, 999999), $length, '0', STR_PAD_LEFT); } if ($_SERVER["REQUEST_METHOD"] == "POST") { $name = $conn->real_escape_string($_POST['name']); $username = $conn->real_escape_string($_POST['username']); $dob = $_POST['dob']; $address = $conn->real_escape_string($_POST['address']); $email = $conn->real_escape_string($_POST['email']); $phone = $conn->real_escape_string($_POST['phone']); $password = $_POST['password']; $confirm_password = $_POST['confirm_password']; if ($password !== $confirm_password) { die("මුරපදයන් නොගැලපේ!"); } // Check for duplicates $check = $conn->query("SELECT * FROM users WHERE username='$username' OR email='$email' OR phone='$phone'"); if ($check->num_rows > 0) { die("Username, email, හෝ phone number එක දැනටමත් භාවිතා වේ."); } $hash = password_hash($password, PASSWORD_DEFAULT); $code = generateCode(); $stmt = $conn->prepare("INSERT INTO users (name, username, dob, address, email, phone, password, verification_code) VALUES (?, ?, ?, ?, ?, ?, ?, ?)"); $stmt->bind_param("ssssssss", $name, $username, $dob, $address, $email, $phone, $hash, $code); if ($stmt->execute()) { echo "ලියාපදිංචි වීම සාර්ථකයි! ඔබේ සත්‍යාපන කේතය: <strong>$code</strong><br>"; echo "<a href='verify.php'>සත්‍යාපනය කරන්න</a>"; } else { echo "දෝෂයක් සිදුවිය: " . $stmt->error; } } ?>
