<?php require 'db.php'; if ($_SERVER["REQUEST_METHOD"] == "POST") { $identifier = $conn->real_escape_string($_POST['identifier']); $code = $conn->real_escape_string($_POST['code']); $password = $_POST['password']; $confirm = $_POST['confirm']; if ($password !== $confirm) { die("❌ මුරපදයන් නොගැලපේ."); } $check = $conn->query("SELECT * FROM users WHERE (email='$identifier' OR phone='$identifier') AND verification_code='$code'"); if ($check->num_rows === 1) { $hash = password_hash($password, PASSWORD_DEFAULT); $conn->query("UPDATE users SET password='$hash', verification_code=NULL WHERE (email='$identifier' OR phone='$identifier')"); echo "✅ මුරපදය යාවත්කාලීන විය. දැන් ඔබට login විය හැක."; echo "<br><a href='index.php'>Login කරන්න</a>"; } else { echo "❌ සත්‍යාපන කේතය හෝ Email/Phone එක වැරදියි."; } } ?> <!DOCTYPE html> <html lang="si"> <head> <meta charset="UTF-8"> <title>මුරපදය යාවත්කාලීන කරන්න</title> <link rel="stylesheet" href="assets/style.css"> </head> <body> <h2>මුරපදය යාවත්කාලීන කරන්න</h2> <form method="POST"> <input type="text" name="identifier" placeholder="Email හෝ Phone" required> <input type="text" name="code" placeholder="සත්‍යාපන කේතය" required> <input type="password" name="password" placeholder="නව මුරපදය" required> <input type="password" name="confirm" placeholder="නව මුරපදය නැවත" required> <button type="submit">Reset Password</button> </form> </body> </html>
